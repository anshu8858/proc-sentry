services:
  atop-exporter:
    build: .
    image: atop-exporter:latest
    container_name: atop-exporter
    restart: unless-stopped
    ports:
      - "9105:9105"
    pid: host
    volumes:
      - /proc:/proc:ro
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
    cap_add:
      - SYS_PTRACE
    environment:
      - ATOP_HOSTNAME=${HOSTNAME:-my-host}
      - TOP_N=${atop_top_n:-50}
      - ENABLE_DISK_IO=${atop_enable_disk_io:-true}
      - ENABLE_PORTS=${atop_enable_ports:-false}
    read_only: true
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
